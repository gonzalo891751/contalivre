{
  "permissions": {
    "allow": [
      "Bash(npm install:*)",
      "Bash(npm run build:*)",
      "Bash(git fetch:*)",
      "Bash(git merge:*)",
      "Bash(gh pr list:*)",
      "Bash(gh pr:*)",
      "Bash(git commit:*)",
      "Bash(git push:*)",
      "Bash(git mv:*)",
      "Bash(timeout 15 npm run dev:*)",
      "Bash(find:*)",
      "Bash(npx tsc:*)",
      "Bash(npx vite build:*)",
      "Bash(dir:*)",
      "Bash(test:*)",
      "Bash(python3:*)",
      "Bash(/c/Python313/python:*)",
      "Bash(del \"D:\\\\Git\\\\ContaLivre\\\\src\\\\pages\\\\Planillas\\\\_cierre_replacement.tsx\")",
      "Bash(npm run test:*)",
      "Bash(npm test)",
      "Bash(echo '\n\n---\n\n## CHECKPOINT #IMPUESTOS-FIX-PANTALLA-BLANCA-AUTONOMOS\n**Fecha:** 2026-02-02\n**Estado:** COMPLETADO - Build PASS \\(tsc + vite\\)\n**Objetivo:** Arreglar pantalla blanca en /operaciones/impuestos, conectar tarjeta \"\"Fiscal/Impuestos\"\" con datos reales, e implementar soporte para Autónomos \\(aportes previsionales\\).\n\n### Problema diagnosticado\n1. **Pantalla blanca:** El módulo ImpuestosPage usaba un import dinámico de `db` dentro de un useEffect, mezclado con imports estáticos en hooks. Sin Error Boundary para capturar errores de render.\n2. **Tarjeta no clickeable:** La tarjeta \"\"Fiscal/Impuestos\"\" en OperacionesPage tenía `cursor-pointer` pero no `onClick`, y mostraba números hardcodeados.\n\n### Archivos modificados\n\n**src/pages/Operaciones/ImpuestosPage.tsx:**\n- Agregado Error Boundary \\(ImpuestosErrorBoundary\\) con UI de recuperación\n- Cambiado import dinámico de `db` a import estático\n- Agregado try/catch en useEffect de loadAccounts\n- Agregado soporte para updateAutonomosSettings del hook\n- Modificado VencimientosTab para incluir card de Autónomos \\(solo RI\\)\n- Actualizado handleGenerateEntry para soportar tipo ''''autonomos''''\n\n**src/pages/OperacionesPage.tsx:**\n- Agregados imports: useTaxClosure, useUpcomingTaxNotifications, Clock icon\n- Agregados estados/memos para taxStatus y taxPosition\n- Tarjeta Impuestos: agregado onClick con navegación a /operaciones/impuestos\n- Tarjeta Impuestos: conectada con datos reales del hook \\(posición IVA, estado\\)\n- Agregado guard para NaN en formatCurrency\n\n**src/core/impuestos/types.ts:**\n- Agregado ''''AUTONOMOS'''' a TaxObligation\n- Agregado AutonomosSettings interface\n- Agregado autonomosSettings a TaxClosePeriod\n- Agregado ''''autonomos'''' a TaxJournalEntryIds\n- Actualizado createDefaultNotification para AUTONOMOS\n- Actualizado getDefaultDueDate para AUTONOMOS con dueDay configurable\n\n**src/storage/impuestos.ts:**\n- Agregado mapping de cuentas autonomosGasto y autonomosAPagar\n- Agregado función generateAutonomosEntry \\(idempotente\\)\n- Agregado función syncAutonomosNotification\n- Modificado generateNotificationsForMonth para soportar Autónomos opcionales\n\n**src/hooks/useTaxClosure.ts:**\n- Agregado import de AutonomosSettings, generateAutonomosEntry, syncAutonomosNotification\n- Agregado updateAutonomosSettings a interface y return\n- Actualizado generateEntry para soportar ''''autonomos''''\n\n### Funcionalidades implementadas\n\n**1. Error Boundary \\(ImpuestosPage\\)**\n- UI amigable al fallar \\(card con mensaje y opciones\\)\n- Botón \"\"Reintentar\"\" para recargar sin refresh\n- Botón \"\"Reparar Almacenamiento\"\" que limpia SOLO taxClosures/taxDueNotifications\n\n**2. Tarjeta Fiscal/Impuestos conectada**\n- Click navega a /operaciones/impuestos\n- Muestra \"\"Posición IVA \\(Est.\\)\"\" calculado del mes actual\n- Estado dinámico: \"\"Al día\"\" \\(verde\\) / \"\"X Vencimientos\"\" \\(ámbar\\) / \"\"Vencido\"\" \\(rojo\\)\n- Accesibilidad: role=\"\"button\"\", tabIndex, onKeyDown\n\n**3. Autónomos \\(opt-in, solo RI\\)**\n- Card en tab Vencimientos con toggle \"\"Aplica\"\"\n- Input de monto mensual \\(solo visible si toggle ON\\)\n- Input de día de vencimiento \\(1-31, según terminación CUIT\\)\n- Botón \"\"Generar Asiento\"\" -> crea asiento idempotente\n- Notificación automática cuando se activa\n- Mappings contables:\n  - autonomosGasto: 4.4.03 \\(Aportes autónomos\\)\n  - autonomosAPagar: 2.1.03.08 \\(Autónomos a pagar\\)\n\n### Validación\n- `npm run build` -> PASS \\(built in ~18s\\)\n- No hay errores de TypeScript\n\n### Criterios de aceptación cumplidos\n- [x] /operaciones/impuestos renderiza sin blanco ni errores\n- [x] Click en tarjeta \"\"Fiscal/Impuestos\"\" navega correctamente\n- [x] Tarjeta muestra números reales \\(no mock\\)\n- [x] Si hasAutonomos=ON: aparece card, genera notificación y asiento\n- [x] Generar asiento Autónomos es idempotente\n- [x] npm run build PASS\n')",
      "Bash(npm run lint)",
      "Bash(npx eslint:*)",
      "Bash(npm test:*)"
    ]
  }
}
